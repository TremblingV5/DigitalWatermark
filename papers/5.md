## RPC

远程过程调用 (Remote Procedure Call，RPC) 是一种计算机通信协议。允许运行在一台计算机的程序调用另一个地址空间的子程序（一般是开放网络中的一台计算机），而程序员就像调用调用本地程序一样，无需额外做交互编程。

手绘 rpc 流程图：

![image-20220609093210634](https://baize-blog-images.oss-cn-shanghai.aliyuncs.com/img/image-20220609093210634.png)

RPC协议本质上定义了一种通信的流程，而具体的实现技术是没有约束的，每一种RPC框架都有自己的实现方式，比如你可以规定自己的RPC请求/响应包含消息头和消息体，使用**`gob/json/pb/thrift`**来序列化/反序列化消息内容，使用**`socket/http2`**进行网络通信，只要**`client`**和**`server`**消息的发送和解析能对应即可。

## Protocol buffer

Protobuf 是由 Google 设计的一种高效、轻量级的信息描述格式，它具有语言中立、平台中立、高效、可扩展等特性，它非常适合用来做数据存储、RPC数据交换等。与 json、xml 相比，Protobuf 的编码长度更短、传输效率更高，其实严格意义上讲，json、xml 并非是一种「编码」, 而只能称之为「格式」，json、xml 的内容本身都是字符形式，它们的编码采用的是 ASCII 编码。

Protobuf 的一个典型应用场景便是做通信的数据交换格式，它在通信管道上是以纯二进制的形式进行传输，发送端使用编码器将数据序列化为二进制, 接收端使用解码器将收到的二进制流进行反序列化从而取得原始信息，因此当对通信管道进行抓包时无法获知数据的详细内容。

两个优势：

1. 序列化速度 & 反序列化速度快
2. 数据压缩效果好，即序列化后的数据量体积小，适合传输数据量较大情况（结合本题需求）

## gRPC

gRPC 是一个高性能、通用的开源 RPC 框架，其由 Google 主要面向移动应用开发并基于 HTTP/2 协议标准而设计，基于 Protocol Buffers 序列化协议开发，且支持众多开发语言。gRPC 提供了一种简单的方法来精确地定义服务和为 iOS、Android 和后台支持服务自动生成可靠性很强的客户端功能库。客户端充分利用高级流和链接功能，从而有助于节省带宽、降低的 TCP 链接次数、节省 CPU 使用、和电池寿命。

## HTTP2

优势：双向流、头部压缩、多复用请求等。这些功能给通信带来很大益处，如节省带宽、降低 TCP 链接次数、节省 CPU 使用和延长电池寿命等。

## 当前项目中如何使用 RPC

1. IDL 定义通信的结构体，RPC 请求体包含需要加密的二进制数据（编码后的需要加密的 python 文件）

```protobuf
// 只是一个例子
syntax = "proto3";
 
message xxxRequest {
	...
}

message xxxResponse {
	...
}
```

2. RPC 的服务端接收到需加密的文件后，将其存入临时目录

3. 调用算法生成图片，将python文件内容存入图像中

4. RPC 将图片数据以二进制形式响应给 rpc 客户端，由客户端反序列化为图片数据



